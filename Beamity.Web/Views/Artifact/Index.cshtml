@model Beamity.Web.Models.AzureViewModels.FilesViewModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="form-group">
    <input type="text" name="name" value="" class="form-control" id="inputName" placeholder="Name" />
</div>

<div class="form-group">
    <select class="form-control" id="rooms"></select>
</div>
<form asp-controller="Artifact" asp-action="UploadFile" method="post">
    <input type="text" name="folder" id="FilePath" placeholder="Folder" />
    <input type="file" name="file" />
    <button type="submit" id="Submit">Upload File</button>
</form>
<input type="submit" name="name" id="SubmitButton" value="" />




<input type="text" id="mesaj" name="name" value="@ViewBag.Mesaj" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="~/package/dist/sweetalert2.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var options = {};
        options.url = "https://beamityapi20190703022513.azurewebsites.net/api/Room/GetAllRooms";
        options.type = "GET";
        options.dataType = "json";
        options.success = function (data) {
            data.forEach(function (v) {
                $("#rooms").append('<option value="' + v.id + '">' + v.name + '</option>');
            });
        };
        options.error = function () {
            alert("error");
        };
        $.ajax(options);
    });


    
    var newFileName;
    function GoPostMethod() {
        function GenerateFilePath() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        var filepath;
        
        var ext;
        var generate;
        $('input[type="file"]').change(function (e) {
            filepath = e.target.files[0].name;
            

        });
        debugger
        //ext = filepath.split('.').pop();
        generate = GenerateFilePath();
        newFileName = generate + ".jpg";

        debugger

        $.ajax({
            url: '/Artifact/UploadFile',
            type: 'POST',
            dataType: 'json',
            data: { inputModel: newFileName },
            success: function (data) {

            }, error: function (data) {
                alert("Hata");
            }


        });
    }

    
    $("#SubmitButton").click(function () {
        //GoPostMethod();

        var mesaj = $("#mesaj").val();
        debugger


        var options = {};
        options.url = "https://localhost:5001/api/Artifact/CreateArtifact";
        options.type = "POST";
        var obj = {};

        obj.Name = $("#inputName").val();
        //obj.MainImageURL = /*"https://testblobkayten.blob.core.windows.net/blobcontainer/" + newFileName + "?sv=2018-03-28&ss=bqtf&srt=sco&sp=rwdlacup&se=2019-07-05T16:28:48Z&sig=E8YuTSKxReDDt8%2F4fvHKiMt*/sNmS8X8KfOXuax9Ut5I4%3D&_=1562317007361";
        obj.MainImageURL = mesaj;
        obj.RoomId = $("#rooms").val();

        options.data = JSON.stringify(obj);
        options.contentType = "application/json";
        options.dataType = "html";
        options.success = function (msg) {
            $("#msg").html(msg);
            Swal({
                type: 'success',
                title: 'Thanks',
                text: 'Operation is success',
            }).then(function () {

                window.location.reload();
            })
        };
        options.error = function () {
            $("#msg").html("Error while calling the Web API!");
        };
        $.ajax(options);
    });
    

</script>
